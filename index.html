<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Let's Go Dutch â€” Split Expenses.Knit Memories</title>
<style>
  /* ===== Theme ===== */
  :root{
    --brand:#0b6cff;
    --text:#1b1b1b;
    --muted:#d9ddff;
    --line:#d9d9d9;
    --bg1:#0b1f4e;
    --bg2:#051234;
    --bg3:#000a1e;
    --cardA:rgba(255,255,255,0.72);
    --cardB:rgba(255,255,255,0.60);
    --radius: 18px;
    --gap: 10px;
  }

  /* Base */
  * { box-sizing: border-box; }
  body {
    margin: 0;
    min-height: 100dvh;
    font-family: Cambria, Georgia, "Times New Roman", Times, serif;
    color: var(--text);
    background:
      radial-gradient(1200px 800px at 20% 25%, #12306e, transparent 60%),
      radial-gradient(900px 700px at 80% 10%, #0e2a63, transparent 55%),
      radial-gradient(800px 800px at 60% 90%, #0a2457, transparent 55%),
      linear-gradient(180deg, var(--bg1) 0%, var(--bg2) 60%, var(--bg3) 100%);
    overflow-x: hidden;
  }

  /* Starfield canvases (behind everything) */
  .stars-wrap {
    position: fixed;
    inset: 0;
    z-index: 0;
    pointer-events: none;
  }
  .stars-wrap canvas {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    display: block;
  }

  /* Content sits above starfield */
  .page { position: relative; z-index: 1; }

  header {
    padding: 28px 16px 14px;
    text-align: center;
  }
  h1 {
    margin: 0;
    font-size: clamp(24px, 5vw, 32px);
    letter-spacing: .2px;
    color: #ffffff;
    text-shadow: 0 2px 10px rgba(0,0,0,.5), 0 0 22px rgba(180,210,255,.45);
  }
  .tagline {
    margin: 8px 0 18px;
    color: #ffffff;
    opacity: .95;
    font-size: clamp(14px, 3.6vw, 17px);
    font-style: italic;
    text-shadow: 0 1px 6px rgba(0,0,0,.55), 0 0 12px rgba(160,190,255,.35);
  }

  main { max-width: 980px; margin: 0 auto 44px; padding: 0 16px; }

  /* Frosted cards */
  .card {
    background: linear-gradient(165deg, var(--cardA), var(--cardB));
    border: 1px solid rgba(255,255,255,0.30);
    backdrop-filter: blur(12px) saturate(125%);
    -webkit-backdrop-filter: blur(12px) saturate(125%);
    border-radius: var(--radius);
    box-shadow: 0 18px 60px rgba(0,0,0,.35), 0 1px 0 rgba(255,255,255,.45) inset;
    padding: 16px;
    margin: 18px 0;
  }

  .controls { display: flex; flex-wrap: wrap; gap: var(--gap); align-items: center; margin-bottom: 14px; }
  .controls label { font-weight: 700; color:#0b1f4e; }

  /* CHANGED: narrow slot sized for up to 3 digits, with a hard limit of 999 in HTML */
  .controls input[type="number"] {
    width: 6.5ch; /* ~3 digits plus padding/arrows */
    padding: 10px;
    border: 1px solid var(--line); border-radius: 12px;
    font-size: 16px; background: #fff;
    font-family: Cambria, Georgia, "Times New Roman", Times, serif;
    text-align: right;
  }

  .summary-pill {
    display: inline-block; padding: 6px 10px; border-radius: 999px;
    background: #eef4ff; border: 1px solid #cfe0ff;
    font-variant-numeric: tabular-nums; color:#0b1f4e;
  }
  .spacer { flex: 1 1 auto; }

  .table-wrap { overflow-x: auto; -webkit-overflow-scrolling: touch; }
  table { width: 100%; border-collapse: collapse; min-width: 560px; background: transparent; }
  th, td { padding: 10px; border-bottom: 1px solid var(--line); text-align: left; }
  th { font-size: 13px; text-transform: uppercase; letter-spacing: .03em; color: #26304d; }
  tbody tr:last-child td { border-bottom: none; }
  input[type="text"], input[type="number"].money {
    width: 100%; padding: 10px; border: 1px solid var(--line); border-radius: 12px;
    font-size: 16px; background: #fff; font-family: Cambria, Georgia, "Times New Roman", Times, serif;
  }

  .right { text-align: right; }
  .muted { color: var(--muted); font-size: 13px; }
  .neg { color: #b00020; font-variant-numeric: tabular-nums; }
  .pos { color: #0a7a29; font-variant-numeric: tabular-nums; }
  .mono { font-variant-numeric: tabular-nums; font-family: Cambria, Georgia, "Times New Roman", Times, serif; }
  .row-actions { display: flex; gap: 8px; }
  .btn {
    padding: 8px 12px; border-radius: 12px; border: 1px solid var(--line);
    background: #fff; cursor: pointer; font-size: 15px;
    box-shadow: 0 6px 18px rgba(11,108,255,0.15);
  }
  .btn:hover { background: #f5f7ff; border-color:#cfe0ff; }
  .btn.brand { background: var(--brand); color: #fff; border-color: var(--brand); }
  .small { font-size: 12px; }

  /* --- Download button container --- */
  .download-wrap { text-align:center; margin: 20px 0 60px; }
  .no-print { display: inline-block; }

  /* ===== Print styles (for crisp PDF) ===== */
  @media print {
    body {
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
      background: #ffffff !important;
    }
    .stars-wrap { display: none !important; }  /* hide animation on PDF */
    header h1, header .tagline {
      color: #000 !important;
      text-shadow: none !important;
    }
    .card {
      background: #ffffff !important;
      border: 1px solid #cccccc !important;
      box-shadow: none !important;
      break-inside: avoid;
      page-break-inside: avoid;
    }
    .summary-pill { background:#f2f6ff !important; border-color:#dbe6ff !important; color:#0b1f4e !important; }
    .download-wrap, .no-print { display: none !important; } /* hide the button */
    table { min-width: auto !important; }
  }

  @media (max-width: 640px) {
    h1 { font-size: 22px; }
    .controls { gap: 12px; }
    .controls input[type="number"] { width: 6.5ch; } /* keep the compact 3-digit slot on mobile too */
    th.hide-sm, td.hide-sm { display: none; }
  }
</style>
</head>
<body>
  <!-- Animated starfield (two layers for subtle parallax) -->
  <div class="stars-wrap" aria-hidden="true">
    <canvas id="starsBack"></canvas>
    <canvas id="starsFront"></canvas>
  </div>

  <div class="page" id="pageRoot">
    <header>
      <h1>Let's Go Dutch</h1>
      <div class="tagline"><em>Split Expenses. Knit Memories</em></div>
    </header>

    <main>
      <section class="card">
        <div class="controls">
          <label for="travellers">Participants:</label>
          <!-- CHANGED: limit to 3 digits -->
          <input id="travellers" type="number" min="1" max="999" step="1" value="3" inputmode="numeric" />
          <span class="spacer"></span>
          <span id="summary" class="summary-pill mono"></span>
        </div>

        <div class="table-wrap">
          <table id="peopleTable" aria-label="People and expenses">
            <thead>
              <tr>
                <th style="width:34%">Name</th>
                <th style="width:22%" class="right">Expenses Paid</th>
                <th style="width:22%" class="right">Balance</th>
                <th class="hide-sm" style="width:22%">Actions</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
            <tfoot>
              <tr>
                <td class="right"><strong>Totals</strong></td>
                <td class="right mono" id="totalPaid">0.00</td>
                <td class="right mono" id="totalBalance">0.00</td>
                <td class="hide-sm"></td>
              </tr>
            </tfoot>
          </table>
          <div class="small muted" style="margin-top:8px">Rows adjust automatically when you change the traveller count. Balances update as you type.</div>
        </div>
      </section>

      <section class="card">
        <h3 style="margin: 0 0 10px; color:#0b1f4e;">Who should pay whom</h3>
        <div id="settlementsWrap">
          <div class="table-wrap">
            <table id="settlementsTable" aria-label="Settlement transfers" style="display:none; min-width:420px;">
              <thead>
                <tr>
                  <th style="width:40%">From</th>
                  <th style="width:40%">To</th>
                  <th class="right" style="width:20%">Amount</th>
                </tr>
              </thead>
              <tbody id="settlementsBody"></tbody>
              <tfoot>
                <tr>
                  <td colspan="3" class="right mono" id="settlementCheck"></td>
                </tr>
              </tfoot>
            </table>
          </div>
          <div id="noSettlements" class="muted">No settlements yet. Start entering amounts.</div>
        </div>
      </section>

      <!-- Download PDF button -->
      <div class="download-wrap">
        <button id="downloadPdfBtn" class="btn brand no-print" type="button" title="Download this page as PDF">Download PDF</button>
      </div>
    </main>
  </div>

<script>
  /* ===== Logic (unchanged except requested wording) ===== */
  const fmt = (n) => (isNaN(n) ? "0.00" : Number(n).toFixed(2));
  const money = (n) => fmt(n);

  const tbody = document.getElementById('tbody');
  const totalPaidEl = document.getElementById('totalPaid');
  const totalBalanceEl = document.getElementById('totalBalance');
  const settlementsTable = document.getElementById('settlementsTable');
  const settlementsBody = document.getElementById('settlementsBody');
  const noSettlements = document.getElementById('noSettlements');
  const summary = document.getElementById('summary');
  const travellersInput = document.getElementById('travellers');

  function addRow(name = "", paid = "") {
    const tr = document.createElement('tr');

    const tdName = document.createElement('td');
    const nameInput = document.createElement('input');
    nameInput.type = 'text';
    nameInput.placeholder = 'Name';
    nameInput.value = name;
    nameInput.autocomplete = 'name';
    tdName.appendChild(nameInput);

    const tdPaid = document.createElement('td');
    tdPaid.className = 'right';
    const paidInput = document.createElement('input');
    paidInput.className = 'money';
    paidInput.type = 'number';
    paidInput.step = '0.01';
    paidInput.min = '0';
    paidInput.placeholder = '0.00';
    paidInput.inputMode = 'decimal';
    paidInput.value = paid;
    paidInput.addEventListener('input', recalcLive, { passive: true });
    tdPaid.appendChild(paidInput);

    const tdBalance = document.createElement('td');
    tdBalance.className = 'right mono';
    tdBalance.textContent = '0.00';

    const tdActions = document.createElement('td');
    tdActions.className = 'hide-sm';
    const delBtn = document.createElement('button');
    delBtn.className = 'btn';
    delBtn.type = 'button';
    delBtn.textContent = 'Remove';
    delBtn.addEventListener('click', () => {
      tr.remove();
      travellersInput.value = Math.max(1, tbody.children.length);
      recalcLive();
    });
    tdActions.appendChild(delBtn);

    tr.appendChild(tdName);
    tr.appendChild(tdPaid);
    tr.appendChild(tdBalance);
    tr.appendChild(tdActions);

    tbody.appendChild(tr);
  }

  function setRowCount(n) {
    n = Math.max(1, Math.floor(Number(n) || 0));
    while (tbody.children.length < n) addRow();
    while (tbody.children.length > n) tbody.lastElementChild.remove();
    recalcLive();
  }

  function getData() {
    const rows = Array.from(tbody.querySelectorAll('tr'));
    return rows.map((tr, idx) => {
      const name = tr.querySelector('input[type="text"]').value.trim() || `Person ${idx+1}`;
      const paid = parseFloat(tr.querySelector('input.money').value);
      return { idx, name, paid: isNaN(paid) ? 0 : paid, balance: 0 };
    });
  }

  function recalc() {
    const people = getData();
    const n = people.length || 1;
    const totalPaid = people.reduce((s, p) => s + p.paid, 0);
    const perHead = totalPaid / n;

    people.forEach(p => p.balance = +(perHead - p.paid).toFixed(2));

    people.forEach((p, i) => {
      const row = tbody.children[i];
      const balCell = row.children[2]; // Balance column (between Paid and Actions)
      balCell.textContent = money(p.balance);
      balCell.classList.toggle('pos', p.balance > 0);
      balCell.classList.toggle('neg', p.balance < 0);
    });

    totalPaidEl.textContent = money(totalPaid);
    const totalBalance = people.reduce((s, p) => s + p.balance, 0);
    totalBalanceEl.textContent = money(totalBalance);

    /* CHANGED: label wording */
    summary.textContent = `Total: â‚¹${money(totalPaid)} â€¢ Pax: â‚¹${money(perHead)}`;

    const transfers = computeSettlements(people);
    renderSettlements(transfers);

    const checkSum = transfers.reduce((s,t)=>s+t.amount,0);
    const owesSum = people.filter(p=>p.balance>0).reduce((s,p)=>s+p.balance,0);
    const recSum  = -people.filter(p=>p.balance<0).reduce((s,p)=>s+p.balance,0);
    document.getElementById('settlementCheck').textContent =
      `Check: pays total â‚¹${money(owesSum)} â‰ˆ receives total â‚¹${money(recSum)} â€¢ transfers sum â‚¹${money(checkSum)}`;
  }

  function computeSettlements(people) {
    const debtors = people.filter(p => p.balance > 0).map(p => ({ name: p.name, amt: +p.balance.toFixed(2) }));
    const creditors = people.filter(p => p.balance < 0).map(p => ({ name: p.name, amt: +(-p.balance).toFixed(2) }));
    const transfers = [];
    let i = 0, j = 0;
    while (i < debtors.length && j < creditors.length) {
      const pay = Math.min(debtors[i].amt, creditors[j].amt);
      if (pay > 0) transfers.push({ from: debtors[i].name, to: creditors[j].name, amount: +pay.toFixed(2) });
      debtors[i].amt = +(debtors[i].amt - pay).toFixed(2);
      creditors[j].amt = +(creditors[j].amt - pay).toFixed(2);
      if (debtors[i].amt <= 0) i++;
      if (creditors[j].amt <= 0) j++;
    }
    return transfers;
  }

  function renderSettlements(transfers) {
    settlementsBody.innerHTML = '';
    if (!transfers.length) {
      settlementsTable.style.display = 'none';
      noSettlements.style.display = 'block';
      return;
    }
    transfers.forEach(t => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${t.from}</td><td>${t.to}</td><td class="right mono">${money(t.amount)}</td>`;
      settlementsBody.appendChild(tr);
    });
    noSettlements.style.display = 'none';
    settlementsTable.style.display = 'table';
  }

  function recalcLive() { recalc(); }

  travellersInput.addEventListener('input', () => setRowCount(travellersInput.value), { passive: true });
  travellersInput.addEventListener('change', () => setRowCount(travellersInput.value));

  // Init
  setRowCount(travellersInput.value || 3);
  recalc();

  /* ===== Animated Starfield (Canvas) ===== */
  (function(){
    const DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1)); // cap DPR

    function makeLayer(canvas, count, speedMin, speedMax, sizeMin, sizeMax, alphaMin, alphaMax){
      const ctx = canvas.getContext('2d');
      const stars = [];
      function rand(a,b){ return a + Math.random()*(b-a); }

      function resize(){
        const {innerWidth:w, innerHeight:h} = window;
        canvas.width = w * DPR;
        canvas.height = h * DPR;
        canvas.style.width = w + 'px';
        canvas.style.height = h + 'px';
        stars.length = 0;
        for (let i=0;i<count;i++){
          stars.push({
            x: Math.random()*canvas.width,
            y: Math.random()*canvas.height,
            r: rand(sizeMin, sizeMax)*DPR,
            a: rand(alphaMin, alphaMax),
            v: rand(speedMin, speedMax)*DPR,
            tw: rand(0.002, 0.006) * (Math.random()<0.5?-1:1)
          });
        }
      }

      function step(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.save();
        ctx.fillStyle = '#fff';
        for (const s of stars){
          s.y += s.v;
          if (s.y - s.r > canvas.height) s.y = -s.r;
          s.a += s.tw;
          if (s.a > alphaMax || s.a < alphaMin) s.tw *= -1;
          ctx.globalAlpha = Math.max(alphaMin, Math.min(alphaMax, s.a));
          ctx.beginPath();
          ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
          ctx.fill();
        }
        ctx.restore();
        requestAnimationFrame(step);
      }

      resize();
      window.addEventListener('resize', resize);
      step();
    }

    makeLayer(document.getElementById('starsBack'), 120, 0.05, 0.12, 0.35, 0.8, 0.15, 0.35);
    makeLayer(document.getElementById('starsFront'), 60, 0.10, 0.25, 0.6, 1.2, 0.25, 0.55);
  })();

  /* ===== Download PDF: uses native print to Save as PDF ===== */
  document.getElementById('downloadPdfBtn').addEventListener('click', () => {
    window.print();
  });
</script>
</body>
</html>
